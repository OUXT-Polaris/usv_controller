<launch>
    <arg name="use_sim_time" default="false"/>
    <arg name="joystick_type" default="DualSense"/>
    <arg name="joystick_connection_timeout" default="10.0"/>
    
    <node_container pkg="rclcpp_components" exec="component_container_mt" name="controller_container" namespace="control" args="">
        <param name="thread_num" value="4"/>

        <composable_node pkg="joy" plugin="joy::Joy" name="joy_node" namespace="control">
            <param name="use_sim_time" value="$(var use_sim_time)"/>
            <param name="use_intra_process_comms" value="true"/>
            <param name="autorepeat_rate" value="30.0"/>
        </composable_node>

        <composable_node pkg="usv_controller" plugin="usv_controller::UsvControllerComponent" name="controller_node" namespace="control">
            <param name="use_sim_time" value="$(var use_sim_time)"/>
            <param name="use_intra_process_comms" value="true"/>
            <param name="joystick_type" value="$(var joystick_type)"/>
            <param name="joystick_connection_timeout" value="$(var joystick_connection_timeout)"/>
        </composable_node>
    </node_container>

    <node_container pkg="rclcpp_components" exec="component_container_mt" name="thruster_container" namespace="control" args="">
        <param name="thread_num" value="4"/>

        <composable_node pkg="udp_driver" plugin="drivers::udp_driver::UdpSenderNode" name="left_thruster_controller_node" namespace="control">
            <param name="use_sim_time" value="$(var use_sim_time)"/>
            <param name="use_intra_process_comms" value="true"/>
            <param name="ip" value="192.168.0.200"/>
            <param name="port" value="1000"/>
            <remap from="udp_write" to="left_thruster_controller_node/udp_write"/>
        </composable_node>

        <composable_node pkg="udp_driver" plugin="drivers::udp_driver::UdpSenderNode" name="right_thruster_controller_node" namespace="control">
            <param name="use_sim_time" value="$(var use_sim_time)"/>
            <param name="use_intra_process_comms" value="true"/>
            <param name="ip" value="192.168.0.210"/>
            <param name="port" value="2000"/>
            <remap from="udp_write" to="right_thruster_controller_node/udp_write"/>
        </composable_node>
    </node_container>

</launch>
